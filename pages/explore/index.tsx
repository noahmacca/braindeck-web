import _ from 'lodash';
import NavBar from "../../components/NavBar";
import PageHead from "../../components/PageHead";
import LpListSection from "../../components/LpListSection";
import SubjectListSection from "../../components/SubjectListSection";
import { getLearningPathData } from '../../lib/learningPaths';
import { getUserData } from '../../lib/user';

export async function getStaticProps() {
    const learningPaths = getLearningPathData()
    const users = getUserData()
    return {
        props: {
            learningPaths,
            users
        }
    }
}

const sampleSubjects  = {
    top: ['BIOLOGY', 'MACHINE LEARNING'], // max 5
    all: [ // max 15; divisible by 3
        {
            id: 'web_dev',
            name: 'WEB DEVELOPMENT'
        },
        {
            id: 'data_science',
            name: 'DATA SCIENCE'
        },
        {
            id: 'product_management',
            name: 'PRODUCT MANAGEMENT'
        },
        {
            id: 'web_design',
            name: 'WEB DESIGN'
        },
        {
            id: 'cryptocurrency',
            name: 'CRYPTOCURRENCY'
        },
        {
            id: 'philosophy',
            name: 'PHILOSOPHY'
        },
        {
            id: 'history',
            name: 'HISTORY'
        },
        {
            id: 'geopolitics',
            name: 'GEOPOLITICS'
        },
        {
            id: 'mindfulness',
            name: 'MINDFULNESS'
        }
    ]
};
    
function mapSubjectToLps(lps) {
    const lpsBySubject = {};
    lps.forEach((lp) => {
        const subject = lp.data.subject;
        if (!(subject in lpsBySubject)) {
            lpsBySubject[subject] = []
        }
        lpsBySubject[subject].push(lp)
    });
    return lpsBySubject
}

export default function Explore({ learningPaths, users }) {
    // Page layout
    // Search (eventually)
    // Filters (by length, difficulty, modality)

    // Sections (Dynamically generated by popularity)
    // Popular (Overall)
    // Section 1
    // Section 2
    // Section 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    // More sections (SubjectList)

    // Within each section: 5 learning paths with summaries, and a link to more learning paths (SubjectLearningPaths)
    const lpsBySubject = mapSubjectToLps(learningPaths);

    return (
        <div>
            <PageHead title="BrainDeck Explore" />
            <NavBar />
            <div className="relative bg-white overflow-hidden">
                <div className="mx-auto px-6 mt-6 max-w-4xl">
                    <div className="container mb-6 md:mb-10">
                        <h1>Top</h1>
                        {
                            sampleSubjects.top.map((subject) => (
                                <LpListSection
                                    key={`${subject}`}
                                    title={subject}
                                    lps={lpsBySubject[subject]}
                                    userData={users[0].data}
                                />
                            ))
                        }
                    </div>
                    <div className="container mb-2">
                        <h1>All Subjects</h1>
                        <SubjectListSection
                            subjects={sampleSubjects.all}
                        />
                    </div>
                </div>
            </div>
        </div>
    )
}